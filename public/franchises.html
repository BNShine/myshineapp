<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franchise Royalties</title>
    <link href="output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .calculation-table input[type="text"],
        .calculation-table input[type="number"],
        .calculation-table select { background-color: transparent !important; border: 1px solid hsl(var(--border)); padding: 0.25rem 0.5rem; border-radius: 0.375rem; transition: all 0.2s; font-size: 0.875rem; }
        .calculation-table input:focus, .calculation-table select:focus { border-color: hsl(var(--brand-primary)); outline: none; }
        .calculation-table input:disabled { background-color: hsl(var(--muted)) !important; color: hsl(var(--muted-foreground)); cursor: not-allowed; }
        .calculation-table .red-text { color: hsl(0 84.2% 60.2%) !important; font-weight: 500; }
        .calculation-table .checkbox-cell { display: flex; justify-content: center; align-items: center; height: 100%; }
        .calculation-table input[type="checkbox"] { transform: scale(1.1); }
        .fee-checkbox-label { @apply flex items-center space-x-2 text-sm; }
        .fee-checkbox { @apply h-4 w-4 rounded border-gray-300 text-brand-primary focus:ring-brand-primary; }
        .franchise-list-item { @apply flex justify-between items-center p-3 border-b border-border; }
        .franchise-list-item:last-child { @apply border-b-0; }
        .loading-overlay { position: absolute; inset: 0; background-color: rgba(255, 255, 255, 0.7); display: flex; align-items: center; justify-content: center; z-index: 10; }
        .dark .loading-overlay { background-color: rgba(0, 0, 0, 0.7); }
        .rule-grid { display: grid; grid-template-columns: auto auto 1fr auto; gap: 0.5rem 1rem; align-items: center; border-bottom: 1px solid hsl(var(--border)); padding-bottom: 0.75rem; margin-bottom: 0.75rem; }
        .rule-grid label { font-size: 0.8rem; text-align: right; }
        .rule-grid input[type=number] { padding: 0.2rem 0.4rem; font-size: 0.8rem; max-width: 80px; }
        .rule-grid .rule-keyword-input { font-size: 0.875rem; font-weight: 500; padding: 0.2rem 0.4rem;}
        .rule-grid input[type=checkbox]{ margin-right: 0.5rem; }
        .rule-grid .delete-rule-btn { background: none; border: none; color: hsl(0 84.2% 60.2%); cursor: pointer; padding: 0.25rem; }
        .rule-grid .delete-rule-btn:hover { color: hsl(0 84.2% 40.2%); }
        .config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .config-grid label { margin-bottom: 0.25rem; }
        .custom-fee-row { display: grid; grid-template-columns: auto 1fr auto auto auto; gap: 0.5rem 1rem; align-items: center; border-bottom: 1px solid hsl(var(--border)); padding-bottom: 0.75rem; margin-bottom: 0.75rem; }
        .custom-fee-row label { font-size: 0.8rem; }
        .custom-fee-row input, .custom-fee-row select { height: 2rem; font-size: 0.875rem; padding: 0.2rem 0.4rem;}
        .custom-fee-row .delete-fee-btn { background: none; border: none; color: hsl(0 84.2% 60.2%); cursor: pointer; padding: 0.25rem; }
        /* Nova Classe para a linha do Loan */
        .loan-payment-row { background-color: #e6ffed; /* Verde claro */ }
        .dark .loan-payment-row { background-color: #1c3d26; /* Verde escuro para dark mode */ }
        .edit-loan-link { cursor: pointer; color: hsl(var(--brand-primary)); text-decoration: underline; }
        .edit-loan-link:hover { color: hsl(var(--brand-primary-hover)); }
    </style>
</head>
<body class="min-h-screen bg-background text-foreground">
    <div class="flex">
        <aside class="sidebar">
             <div class="flex h-16 items-center justify-center border-b px-6"> <a class="flex items-center gap-2 font-semibold" href="appointments.html"> <img src="https://i.imgur.com/bW695v3.png" alt="Logo" class="h-10 w-auto"/> <span class="sr-only">Myshineapp</span> </a> </div>
             <nav class="flex-1 overflow-auto p-4"> <ul class="grid items-start gap-1 text-sm font-medium"> <li><a class="sidebar-link" href="appointments.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>Sales</a></li> <li><a class="sidebar-link" href="customers.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>Customers</a></li> <li><a class="sidebar-link" href="analytics.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>Analytics</a></li> <li><a class="sidebar-link" href="calendar.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>Calendar</a></li> <li><a class="sidebar-link" href="quick-routes.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><circle cx="12" cy="12" r="10"/><path d="M12 2a10 10 0 1 0 10 10"/><path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z"/><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></svg>Routes</a></li> <li><a class="sidebar-link" href="finance.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>Finance</a></li> <li><a class="sidebar-link active" href="franchises.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building h-4 w-4"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/></svg>Franchises</a></li> </ul> </nav>
        </aside>

        <div class="main-content flex flex-col flex-1 relative">
            <header class="sticky top-0 z-30 flex h-14 items-center gap-4 border-b bg-card px-6">
                 <div class="text-sm text-muted-foreground"> <span class="font-semibold text-foreground">Franchises</span> / Royalty Calculation </div>
                 <div class="ml-auto flex items-center gap-2"> <button id="dark-mode-toggle" class="btn btn-ghost w-10 h-10 p-0"> <svg class="w-5 h-5 block dark:hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg> <svg class="w-5 h-5 hidden dark:block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg> </button> </div>
            </header>

            <main class="flex-1 p-4 sm:p-6 space-y-6">
                <h1 class="text-page-title">Franchise Management & Royalty Calculation</h1>

                <section id="royalty-calculation-section" class="card-base">
                     <div class="p-6 border-b flex justify-between items-center"> <h2 class="text-section-title">Royalty Calculation</h2> </div>
                     <div class="p-6 space-y-6">
                         <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                             <div class="md:col-span-1"> <label class="text-label mb-2 block" for="franchise-select">Select Franchise</label> <select id="franchise-select" class="input-base"> <option value="">-- Select a Registered Franchise --</option> </select> </div>
                             <div class="md:col-span-1"> <label class="text-label mb-2 block" for="report-month-select">Report Month</label> <select id="report-month-select" class="input-base franchise-month"> </select> </div>
                             <div class="md:col-span-1"> <label class="text-label mb-2 block">Upload Report File(s)</label> <input type="file" id="file-input" class="file-input block w-full text-sm text-muted-foreground file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-brand-primary/10 file:text-brand-primary hover:file:bg-brand-primary/20" multiple accept=".csv, .xlsx" disabled> <div class="loading-spinner hidden mt-2 flex items-center"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-brand-primary mr-2"></div> Processing...</div> </div>
                         </div>
                         <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t mt-4"> <div class="card-base p-3"> <p class="text-sm text-muted-foreground">Pets Serviced</p> <p class="text-xl font-bold metric-pets">0</p> </div> <div class="card-base p-3"> <p class="text-sm text-muted-foreground">Services Count</p> <p class="text-xl font-bold metric-services-count">0</p> </div> <div class="card-base p-3"> <p class="text-sm text-muted-foreground">Adjusted Total Value</p> <p class="text-xl font-bold metric-total-value">$0.00</p> </div> <div class="card-base p-3 bg-muted"> <p class="text-sm text-muted-foreground">Total Fees Due</p> <p class="text-xl font-bold metric-total-fees">$0.00</p> </div> </div>
                         <div class="pt-4 border-t mt-4">
                             <h3 class="text-card-title mb-4">Fee Calculation Table</h3>
                             <div class="overflow-x-auto calculation-table">
                                 <table class="w-full text-left">
                                     <thead class="bg-muted text-muted-foreground uppercase text-xs font-semibold whitespace-nowrap"> <tr> <th class="p-3 border-b w-[25%]">Item</th> <th class="p-3 border-b w-[25%]">Description</th> <th class="p-3 border-b w-[15%] text-center">Qty / %</th> <th class="p-3 border-b w-[15%] text-right">Unit Price</th> <th class="p-3 border-b w-[15%] text-right">Amount</th> <th class="p-3 border-b w-[5%] text-center">Disable</th> <th class="p-3 border-b w-[5%]"></th> </tr> </thead>
                                     <tbody class="text-foreground text-sm calculation-tbody"> <tr><td colspan="7" class="p-4 text-center text-muted-foreground italic">Select a franchise and upload a file to calculate fees.</td></tr> </tbody>
                                     <tfoot class="bg-muted text-foreground font-semibold"> <tr> <td colspan="4" class="p-3 text-right">TOTAL DUE:</td> <td class="p-3 text-right calculation-total">$0.00</td> <td colspan="2"></td> </tr> </tfoot>
                                 </table>
                             </div>
                             <button class="btn-outline mt-4 add-calculation-row-btn" disabled>+ Add Custom Row</button>
                         </div>
                     </div>
                </section>

                <section id="franchise-register-section" class="card-base relative">
                    <div id="register-section-loader" class="loading-overlay hidden absolute inset-0 bg-background/70 dark:bg-background/50 flex items-center justify-center z-10"> <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-brand-primary"></div> </div>
                    <div class="p-6 border-b"> <h2 class="text-section-title">Franchise Register</h2> <p class="text-body mt-1">Add, edit, or remove franchise configurations.</p> </div>
                    <div class="p-6 space-y-4">
                        <h3 class="text-card-title">Add New Franchise</h3>
                        <form id="add-franchise-form" class="space-y-6 border-b pb-6 mb-6">
                             <div> <label for="new-franchise-name" class="text-label mb-1 block">Franchise Name</label> <input type="text" id="new-franchise-name" placeholder="Enter unique name" required class="input-base h-10"> </div>
                             <div>
                                 <h4 class="text-sub-title mb-2">Base Fees to Include</h4>
                                 <div class="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2"> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox new-fee-checkbox" data-fee-item="Royalty Fee" checked> Royalty Fee</label> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox new-fee-checkbox" data-fee-item="Marketing Fee" checked> Marketing Fee</label> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox new-fee-checkbox" data-fee-item="Software Fee" checked> Software Fee</label> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox new-fee-checkbox" data-fee-item="Call Center Fee" checked> Call Center Fee</label> <div class="flex items-center space-x-2"> <label class="fee-checkbox-label"><input type="checkbox" id="new-include-callcenter-extra-fee" class="fee-checkbox new-fee-checkbox" data-fee-item="Call Center Fee Extra"> Call Center Fee Extra</label> </div> <div id="new-extra-vehicles-wrapper" class="hidden"> <label for="new-extra-vehicles" class="text-label text-xs">Extra Vehicles</label> <input type="number" step="1" min="0" id="new-extra-vehicles" value="0" class="input-base h-7 w-20 ml-2"> </div> </div>
                             </div>
                             <div>
                                 <h4 class="text-sub-title mb-2 border-t pt-4">Fee Values</h4>
                                 <div class="config-grid items-end">
                                     <div>
                                         <div class="flex items-center mb-1">
                                             <input type="checkbox" id="new-has-min-royalty" class="h-4 w-4 rounded border-gray-300 text-brand-primary focus:ring-brand-primary mr-2">
                                             <label for="new-has-min-royalty" class="text-label">Minimum Royalty Fee ($)</label>
                                         </div>
                                         <input type="number" step="0.01" id="new-min-royalty-value" value="1000.00" class="input-base h-9" disabled>
                                     </div>
                                     <div> <label for="new-royalty-rate" class="text-label">Royalty Rate (%)</label> <input type="number" step="0.1" id="new-royalty-rate" value="6.0" class="input-base h-9"> </div>
                                     <div> <label for="new-marketing-rate" class="text-label">Marketing Rate (%)</label> <input type="number" step="0.1" id="new-marketing-rate" value="1.0" class="input-base h-9"> </div>
                                     <div> <label for="new-software-fee" class="text-label">Software Fee ($)</label> <input type="number" step="0.01" id="new-software-fee" value="350.00" class="input-base h-9"> </div>
                                     <div> <label for="new-callcenter-fee" class="text-label">Call Center Fee ($)</label> <input type="number" step="0.01" id="new-callcenter-fee" value="1200.00" class="input-base h-9"> </div>
                                     <div> <label for="new-callcenter-extra" class="text-label">Call C. Extra ($)</label> <input type="number" step="0.01" id="new-callcenter-extra" value="600.00" class="input-base h-9"> </div>
                                 </div>
                             </div>
                             <div>
                                 <h4 class="text-sub-title mb-2 border-t pt-4">Custom Fees</h4>
                                 <div id="new-custom-fees-container" class="space-y-3 mb-3"> </div>
                                 <button type="button" id="add-new-custom-fee-button" class="btn-outline text-xs">+ Add Custom Fee</button>
                             </div>
                             <div>
                                 <h4 class="text-sub-title mb-2 border-t pt-4">Loan Configuration</h4>
                                 <div class="flex items-center mb-3"> <input type="checkbox" id="new-has-loan" class="h-4 w-4 rounded border-gray-300 text-brand-primary focus:ring-brand-primary mr-2"> <label for="new-has-loan" class="text-sm">Include Loan Payment</label> </div>
                                 <div id="new-loan-details-wrapper" class="config-grid grid-cols-3 hidden">
                                     <div> <label for="new-loan-current-installment" class="text-label">Current Installment #</label> <input type="number" step="1" min="0" id="new-loan-current-installment" value="0" class="input-base h-9"> </div>
                                     <div> <label for="new-loan-total-installments" class="text-label">Total Installments #</label> <input type="number" step="1" min="0" id="new-loan-total-installments" value="0" class="input-base h-9"> </div>
                                     <div> <label for="new-loan-value" class="text-label">Value per Installment ($)</label> <input type="number" step="0.01" id="new-loan-value" value="0" class="input-base h-9"> </div>
                                 </div>
                             </div>
                             <div>
                                <h4 class="text-sub-title mb-2 border-t pt-4">Service Value Adjustment Rules</h4>
                                <p class="text-xs text-muted-foreground mb-3">Define minimum/fixed values. Add custom rules as needed.</p>
                                <div id="new-service-rules-container" class="space-y-3 mb-3"> </div>
                                <button type="button" id="add-new-service-rule-button" class="btn-outline text-xs">+ Add Service Rule</button>
                            </div>
                            <div class="flex justify-end pt-4"> <button type="submit" class="btn-primary h-10 px-6">Register Franchise</button> </div>
                        </form>
                        <h3 class="text-card-title">Registered Franchises</h3>
                        <div id="registered-franchises-list" class="border rounded-lg max-h-60 overflow-y-auto"> <p class="p-4 text-muted-foreground italic">Loading registered franchises...</p> </div>
                    </div>
                </section>
            </main>
            <div id="toast-container" class="fixed bottom-5 right-5 z-[100] space-y-2"></div>
        </div>
    </div>

     <div id="edit-franchise-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
         <div class="bg-card p-6 rounded-lg shadow-2xl w-full max-w-[90rem] relative overflow-y-auto max-h-[90vh]">
            <h3 class="text-xl font-bold text-foreground mb-4">Edit Franchise Configuration</h3>
            <input type="hidden" id="edit-original-franchise-name">
            <form id="edit-franchise-form" class="space-y-4">
                <div> <label for="edit-franchise-name" class="text-label mb-1 block">Franchise Name</label> <input type="text" id="edit-franchise-name" required class="input-base h-10"> </div>
                 <div>
                    <h4 class="text-sub-title mb-2">Base Fees to Include</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2"> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox edit-fee-checkbox" data-fee-item="Royalty Fee"> Royalty Fee</label> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox edit-fee-checkbox" data-fee-item="Marketing Fee"> Marketing Fee</label> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox edit-fee-checkbox" data-fee-item="Software Fee"> Software Fee</label> <label class="fee-checkbox-label"><input type="checkbox" class="fee-checkbox edit-fee-checkbox" data-fee-item="Call Center Fee"> Call Center Fee</label> <div class="flex items-center space-x-2"> <label class="fee-checkbox-label"><input type="checkbox" id="edit-include-callcenter-extra-fee" class="fee-checkbox edit-fee-checkbox" data-fee-item="Call Center Fee Extra"> Call Center Fee Extra</label> </div> <div id="edit-extra-vehicles-wrapper" class="hidden"> <label for="edit-extra-vehicles" class="text-label text-xs">Extra Vehicles</label> <input type="number" step="1" min="0" id="edit-extra-vehicles" value="0" class="input-base h-7 w-20 ml-2"> </div> </div>
                 </div>
                 <div>
                    <h4 class="text-sub-title mb-2 border-t pt-4">Fee Values</h4>
                    <div class="config-grid items-end">
                        <div>
                             <div class="flex items-center mb-1">
                                 <input type="checkbox" id="edit-has-min-royalty" class="h-4 w-4 rounded border-gray-300 text-brand-primary focus:ring-brand-primary mr-2">
                                 <label for="edit-has-min-royalty" class="text-label">Minimum Royalty Fee ($)</label>
                             </div>
                             <input type="number" step="0.01" id="edit-min-royalty-value" value="0" class="input-base h-9" disabled>
                         </div>
                        <div> <label for="edit-royalty-rate" class="text-label">Royalty Rate (%)</label> <input type="number" step="0.1" id="edit-royalty-rate" class="input-base h-9"> </div>
                        <div> <label for="edit-marketing-rate" class="text-label">Marketing Rate (%)</label> <input type="number" step="0.1" id="edit-marketing-rate" class="input-base h-9"> </div>
                        <div> <label for="edit-software-fee" class="text-label">Software Fee ($)</label> <input type="number" step="0.01" id="edit-software-fee" class="input-base h-9"> </div>
                        <div> <label for="edit-callcenter-fee" class="text-label">Call Center Fee ($)</label> <input type="number" step="0.01" id="edit-callcenter-fee" class="input-base h-9"> </div>
                        <div> <label for="edit-callcenter-extra" class="text-label">Call C. Extra ($)</label> <input type="number" step="0.01" id="edit-callcenter-extra" class="input-base h-9"> </div>
                    </div>
                 </div>
                 <div>
                     <h4 class="text-sub-title mb-2 border-t pt-4">Custom Fees</h4>
                     <div id="edit-custom-fees-container" class="space-y-3 mb-3"> </div>
                     <button type="button" id="add-edit-custom-fee-button" class="btn-outline text-xs">+ Add Custom Fee</button>
                 </div>
                 <div>
                     <h4 class="text-sub-title mb-2 border-t pt-4">Loan Configuration</h4>
                     <div class="flex items-center mb-3"> <input type="checkbox" id="edit-has-loan" class="h-4 w-4 rounded border-gray-300 text-brand-primary focus:ring-brand-primary mr-2"> <label for="edit-has-loan" class="text-sm">Include Loan Payment</label> </div>
                     <div id="edit-loan-details-wrapper" class="config-grid grid-cols-3 hidden">
                         <div> <label for="edit-loan-current-installment" class="text-label">Current Installment #</label> <input type="number" step="1" min="0" id="edit-loan-current-installment" value="0" class="input-base h-9"> </div>
                         <div> <label for="edit-loan-total-installments" class="text-label">Total Installments #</label> <input type="number" step="1" min="0" id="edit-loan-total-installments" value="0" class="input-base h-9"> </div>
                         <div> <label for="edit-loan-value" class="text-label">Value per Installment ($)</label> <input type="number" step="0.01" id="edit-loan-value" value="0" class="input-base h-9"> </div>
                     </div>
                 </div>
                 <div class="border-t pt-4 mt-4">
                     <h4 class="text-sub-title mb-2">Service Value Adjustment Rules</h4>
                     <p class="text-xs text-muted-foreground mb-3">Define minimum/fixed values for services.</p>
                     <div id="edit-service-rules-container" class="space-y-3 mb-3"> </div>
                     <button type="button" id="add-edit-service-rule-button" class="btn-outline text-xs">+ Add Service Rule</button>
                 </div>
            </form>
            <div class="mt-6 flex justify-end gap-3"> <button id="edit-modal-cancel-btn" type="button" class="btn-outline h-10 px-6 text-sm">Cancel</button> <button id="edit-modal-save-btn" type="button" class="btn-primary h-10 px-6 text-sm">Save Changes</button> </div>
        </div>
    </div>

    <div id="edit-loan-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-[60] hidden">
         <div class="bg-card p-6 rounded-lg shadow-2xl w-full max-w-md relative">
            <h3 class="text-xl font-bold text-foreground mb-4">Edit Loan Details</h3>
            <input type="hidden" id="edit-loan-franchise-name">
            <form id="edit-loan-form" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="modal-loan-current-installment" class="text-label">Current Installment #</label>
                        <input type="number" step="1" min="0" id="modal-loan-current-installment" value="0" class="input-base h-9">
                    </div>
                    <div>
                        <label for="modal-loan-total-installments" class="text-label">Total Installments #</label>
                        <input type="number" step="1" min="0" id="modal-loan-total-installments" value="0" class="input-base h-9">
                    </div>
                </div>
                <div>
                     <label for="modal-loan-value" class="text-label">Value per Installment ($)</label>
                     <input type="number" step="0.01" id="modal-loan-value" value="0" class="input-base h-9">
                 </div>
            </form>
            <div class="mt-6 flex justify-between gap-3">
                <button id="edit-loan-remove-btn" type="button" class="btn-destructive h-10 px-6 text-sm">Remove Loan</button>
                <div>
                     <button id="edit-loan-cancel-btn" type="button" class="btn-outline h-10 px-6 text-sm mr-2">Cancel</button>
                     <button id="edit-loan-save-btn" type="button" class="btn-primary h-10 px-6 text-sm">Save Loan</button>
                </div>
            </div>
        </div>
    </div>

    <script src="franchises.js"></script>
    <script>
        document.getElementById('dark-mode-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
        });
    </script>
</body>
</html>
